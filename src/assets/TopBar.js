import{u as U,r as i,a as m,j as e,F as D,b as P,c as A,d as E,e as B,s as $,f as W}from"./main.js";import{C as _}from"./ContactList.js";function Y({calls:a=[]}){const{dispatch:h}=U(),[l,s]=i.useState(""),d=document.getElementById("zoomCCP"),f=(m(t=>t.common.single_contact)||"Unknown").name||"Unknown";console.log("Username in RecentCalls:",f);const b=i.useMemo(()=>a.map(t=>{var u,g,C,z,T;const c=t.direction==="inbound";return{id:t.callId||t.callLogId,type:c?"incoming":t.direction==="outbound"?"outgoing":"missed",name:c?(u=t.caller)==null?void 0:u.name:f,number:c?(g=t.caller)==null?void 0:g.number:(C=t.callee)==null?void 0:C.number,duration:t.duration||0,dateTime:t.dateTime,email:((z=t.caller)==null?void 0:z.email)||((T=t.callee)==null?void 0:T.email)||null,result:t.result}}),[a,f]),x=i.useMemo(()=>l.trim()?b.filter(t=>t.name&&t.name.toLowerCase().includes(l.toLowerCase())||t.number&&t.number.includes(l)||t.email&&t.email.toLowerCase().includes(l.toLowerCase())):b,[l,b]),k=t=>{if(!d)return console.warn("Zoom CCP not found");d.contentWindow.postMessage({type:"zp-make-call",data:{number:t.number||""}},"https://applications.zoom.us"),window.togglePlatform()},w=t=>{if(!t||isNaN(t))return"0s";const c=Math.floor(t/60),u=t%60;return c>0?`${c}m ${u}s`:`${u}s`},y=["Missed","Call Cancel","Rejected","No Answer"];return e.jsxs("div",{style:{padding:8,fontFamily:"Segoe UI, sans-serif",height:"100%",overflowY:"auto",background:"var(--background)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{marginBottom:10},children:e.jsx("input",{type:"text",value:l,onChange:t=>s(t.target.value),placeholder:"Search recent calls...",style:{width:"100%",padding:"8px 12px",borderRadius:8,border:"1px solid var(--input-border)",outline:"none",fontSize:14,backgroundColor:"var(--input-bg)",color:"var(--text-primary)"}})}),x.length>0?x.map((t,c)=>{const u=y.includes(t.result);return e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"var(--surface)",padding:10,borderRadius:8,marginBottom:8,boxShadow:"0 1px 4px rgba(0,0,0,0.08)",color:"var(--text-primary)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("div",{style:{color:u?"#f44336":t.type==="incoming"?"#4caf50":"#2196f3",fontSize:18},children:u?e.jsx(D,{}):t.type==="incoming"?e.jsx(P,{}):e.jsx(A,{})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("span",{style:{fontWeight:600},children:t.name||"Unknown"}),t.number&&e.jsx("span",{style:{fontSize:13,color:"var(--text-secondary)"},children:t.number}),t.email&&e.jsx("span",{style:{fontSize:12,color:"var(--text-secondary)"},children:t.email}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-secondary)"},children:["Duration: ",w(t.duration)]})]})]}),e.jsx("div",{style:{display:"flex",gap:8,fontSize:16,cursor:"pointer"},children:e.jsx(E,{title:"Call",onClick:()=>k(t),color:"#4caf50",style:{transform:"rotateY(180deg)"}})})]},`${t.id}-${t.dateTime||c}`)}):e.jsx("p",{style:{textAlign:"center",color:"var(--text-secondary)",fontSize:14},children:"No recent calls found"})]})}function H({client:a,onClose:h,onTicketCreated:l}){const s=m(o=>o.common.callData),d=(s==null?void 0:s.callerNumber)||"";s!=null&&s.callerName;const v=m(o=>o.common.single_contact),f=v.name||"Unknown",b=v.id||"null",x=m(o=>{var j;return(j=o.ui)==null?void 0:j.darkMode})||!1,[k,w]=i.useState(""),[y,t]=i.useState("normal"),[c,u]=i.useState(""),[g,C]=i.useState(!1);B();const z=async o=>{if(o.preventDefault(),!!k.trim())try{C(!0);const j=s.direction==="inbound"?45:46,I={ticket:{requester_id:b,subject:k.trim(),priority:y.toLowerCase(),comment:{body:c.trim()},via:{channel:j}}};console.log("Creating ticket with payload:",I);const S=await a.request({url:"/api/v2/tickets.json",type:"POST",contentType:"application/json",data:JSON.stringify(I)});console.log("Ticket creation response:",S);const L=(S==null?void 0:S.ticket)||null;l&&L&&(l(L),h())}catch(j){console.log("Failed to create ticket: "+(j||"Unknown error"))}finally{C(!1)}},T=o=>{switch(o.toLowerCase()){case"low":return"#28a745";case"normal":return"#007bff";case"high":return"#ffc107";case"urgent":return"#dc3545";default:return"#007bff"}};return e.jsxs("div",{style:{position:"relative",height:"100%",display:"flex",flexDirection:"column",padding:"20px",fontFamily:"Segoe UI, sans-serif",background:"var(--surface)",borderRadius:"12px",boxShadow:x?"0 4px 16px rgba(0,0,0,0.28)":"0 4px 12px rgba(0,0,0,0.08)",color:"var(--text-primary)",transition:"background 0.3s, color 0.3s"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"18px",fontWeight:600,color:"var(--text-primary)"},children:"Create Ticket"}),e.jsx("button",{onClick:h,style:{position:"absolute",right:12,top:12,background:"transparent",border:"none",fontSize:"20px",cursor:"pointer",color:"var(--text-secondary)"},children:"âœ•"})]}),e.jsxs("div",{style:{marginBottom:"20px",padding:"12px",background:"var(--input-bg)",borderRadius:"8px",fontSize:"14px",color:"var(--text-secondary)",lineHeight:"1.5"},children:[e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Caller:"})," ",f," ",e.jsx("br",{}),e.jsx("strong",{style:{color:"var(--text-primary)"},children:"Phone:"})," ",d||"N/A"]}),e.jsxs("form",{onSubmit:z,style:{display:"flex",flexDirection:"column",gap:"14px",flex:1},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"14px",marginBottom:"6px",fontWeight:500,color:"var(--text-secondary)"},children:"Subject"}),e.jsx("input",{type:"text",value:k,onChange:o=>w(o.target.value),placeholder:"Enter ticket subject",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:`1px solid ${x?"#555":"#ccc"}`,background:"var(--input-bg)",color:"var(--text-primary)",fontSize:"14px",outline:"none",transition:"0.2s border"},onFocus:o=>o.target.style.border="1px solid #0077ff",onBlur:o=>o.target.style.border=`1px solid ${x?"#555":"#ccc"}`})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"14px",marginBottom:"6px",fontWeight:500,color:"var(--text-secondary)"},children:"Priority"}),e.jsxs("select",{value:y,onChange:o=>t(o.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:`1px solid ${T(y)}`,background:"var(--input-bg)",color:T(y),fontWeight:600,fontSize:"14px",textTransform:"capitalize"},children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",marginBottom:"6px",fontWeight:500,color:"var(--text-secondary)"},children:"Description"}),e.jsx("textarea",{value:c,onChange:o=>u(o.target.value),rows:"4",placeholder:"Provide details about the issue...",style:{width:"100%",padding:"10px 12px",borderRadius:"8px",border:`1px solid ${x?"#555":"#ccc"}`,background:"var(--input-bg)",color:"var(--text-primary)",fontSize:"14px",resize:"vertical",outline:"none"},onFocus:o=>o.target.style.border="1px solid #0077ff",onBlur:o=>o.target.style.border=`1px solid ${x?"#555":"#ccc"}`})]}),e.jsx("button",{type:"submit",disabled:g,style:{padding:"12px 16px",background:g?"#aaa":"#0077ff",color:"#fff",border:"none",borderRadius:"8px",cursor:g?"not-allowed":"pointer",fontSize:"15px",fontWeight:600,marginTop:"4px",transition:"0.2s background"},children:g?"Creating...":"Create Ticket"})]})]})}function O({client:a}){const[h,l]=i.useState([]),s=m(r=>r.common.callData),d=s==null?void 0:s.callerNumber;s==null||s.callerName;const[v,f]=i.useState(!0),[b,x]=i.useState(""),[k,w]=i.useState(!1),[y,t]=i.useState(null),[c,u]=i.useState(""),g=B(),[C,z]=i.useState(null),o=(m(r=>r.common.single_contact)||"Unknown").name||"Unknown";i.useEffect(()=>{g($(o))},[o,g]),console.log("Username from Redux:",o);const j=m(r=>{var p;return(p=r.ui)==null?void 0:p.darkMode})||!1;i.useEffect(()=>{if(!a||!d){x("Missing client or caller number"),f(!1);return}async function r(){f(!0),x("");try{const p=await g(W(d));if(W.fulfilled.match(p)){const R=p.payload;R.length===0?l([]):l(R)}else throw new Error(p.payload||"Failed to fetch tickets")}catch(p){x(p.message.includes("Not found")?"":"Failed to load tickets"),l([])}finally{f(!1)}}r()},[a,d,g]);const I=async r=>{if(r){if(!c.trim())return console.log("Please enter a note before submitting.");try{await a.request({url:`/api/v2/tickets/${r}.json`,type:"PUT",contentType:"application/json",data:JSON.stringify({ticket:{comment:{body:c,public:!1}}})}),console.log("Note added successfully!alert"),t(null),u("")}catch(p){console.log("Failed to add note: "+(p.message||"Unknown error"))}}},S=r=>{switch((r||"").toLowerCase()){case"new":return{background:"#FFA500",color:"#fff"};case"open":return{background:"#FF4136",color:"#fff"};case"pending":return{background:"#007BFF",color:"#fff"};case"onhold":return{background:"#4A4A48",color:"#fff"};case"solved":return{background:"#D3D3D3",color:"#000"};default:return{background:"#e2e3e5",color:"#000"}}},L=r=>{r&&a.invoke("routeTo","ticket",r)};return v?e.jsx("p",{style:{padding:12},children:"Loading tickets..."}):k?e.jsx(H,{client:a,onClose:()=>w(!1),onTicketCreated:r=>l([r,...h])}):e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column",padding:16,fontFamily:"Segoe UI, sans-serif",background:"var(--background)",color:"var(--text-primary)"},children:[e.jsxs("div",{style:{position:"relative",width:"100%",background:j?"var(--surface)":"var(--background)",color:"var(--text-primary)",borderRadius:16,padding:16,display:"flex",alignItems:"center",gap:16,boxShadow:"0 4px 12px rgba(0,0,0,0.08)",fontFamily:"Segoe UI, sans-serif",transition:"all 0.2s ease"},children:[e.jsx("div",{style:{width:64,height:64,borderRadius:"50%",background:"#f0f0f0",display:"flex",justifyContent:"center",alignItems:"center",fontSize:28,fontWeight:"bold",color:"#555",flexShrink:0},children:o[0].toUpperCase()}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:4},children:[e.jsx("div",{style:{fontSize:18,fontWeight:600},children:o}),e.jsx("div",{style:{fontSize:14,color:"#666"},children:d||"-"}),e.jsxs("div",{style:{fontSize:13,display:"flex",alignItems:"center",gap:6,fontWeight:500,color:"#28a745"},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:"50%",background:"#28a745",display:"inline-block"}}),"Connected"]})]}),e.jsx("button",{onClick:()=>w(!0),style:{position:"absolute",bottom:8,right:38,padding:"8px 16px",borderRadius:24,fontSize:14,fontWeight:600,border:"1px solid #4b6cb7",cursor:"pointer",background:"#4b6cb7",color:"#fff",transition:"all 0.2s ease",boxShadow:"0 2px 6px rgba(0,0,0,0.15)"},onMouseEnter:r=>{r.currentTarget.style.background="#3a549a",r.currentTarget.style.borderColor="#3a549a"},onMouseLeave:r=>{r.currentTarget.style.background="#4b6cb7",r.currentTarget.style.borderColor="#4b6cb7"},children:"+ Ticket"})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10},children:e.jsx("h3",{style:{fontSize:16,fontWeight:600,color:"var(--text-primary)",margin:0,display:"flex",alignItems:"center",gap:6},children:"List Of Tickets"})}),e.jsx("div",{style:{height:1,background:"rgba(0,0,0,0.1)",marginBottom:12}}),h.length===0?e.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)",marginTop:40,fontSize:14,opacity:.8},children:e.jsx("p",{children:"No tickets found for this contact."})}):e.jsx("ul",{style:{listStyle:"none",padding:0,margin:0,display:"flex",flexDirection:"column",gap:12},children:h.map(r=>{var p,R,N,F;return e.jsxs("li",{style:{position:"relative",background:"var(--surface)",borderRadius:10,padding:16,boxShadow:"0 3px 8px rgba(0,0,0,0.08)",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease"},onClick:()=>L(r.id),onMouseEnter:n=>{n.currentTarget.style.transform="translateY(-2px)",n.currentTarget.style.boxShadow="0 5px 12px rgba(0,0,0,0.15)"},onMouseLeave:n=>{n.currentTarget.style.transform="translateY(0)",n.currentTarget.style.boxShadow="0 3px 8px rgba(0,0,0,0.08)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("strong",{style:{fontSize:15,display:"block",marginBottom:4},children:r.subject||"Untitled Ticket"}),e.jsxs("span",{style:{fontSize:12,color:"var(--text-secondary)",background:"rgba(0,0,0,0.05)",padding:"2px 6px",borderRadius:6,fontWeight:500},title:`Ticket ID: ${r.id}`,children:["#",r.id]})]}),e.jsxs("div",{style:{display:"flex",gap:8,fontSize:11,alignItems:"center",marginTop:4,flexWrap:"wrap"},children:[e.jsx("span",{style:{background:S(r.status).background,color:S(r.status).color,padding:"2px 6px",borderRadius:10,fontWeight:500,textTransform:"capitalize",transition:"all 0.2s ease"},title:r.status,children:r.status}),e.jsx("span",{style:{background:((p=r.priority)==null?void 0:p.toLowerCase())==="urgent"?"linear-gradient(135deg, #ff4b2b, #ff416c)":((R=r.priority)==null?void 0:R.toLowerCase())==="high"?"linear-gradient(135deg, #f7971e, #ffd200)":((N=r.priority)==null?void 0:N.toLowerCase())==="medium"?"linear-gradient(135deg, #36d1dc, #5b86e5)":((F=r.priority)==null?void 0:F.toLowerCase())==="low"?"linear-gradient(135deg, #56ab2f, #a8e063)":"linear-gradient(135deg, #bdc3c7, #2c3e50)",color:"#fff",padding:"3px 10px",borderRadius:12,fontWeight:600,fontSize:12,textTransform:"capitalize",letterSpacing:"0.3px",boxShadow:"0 1px 4px rgba(0,0,0,0.2)"},title:`Priority: ${r.priority||"Normal"}`,children:r.priority||"Normal"})]}),!y&&e.jsx("div",{style:{position:"absolute",top:45,right:15},children:e.jsx("button",{onClick:n=>{n.stopPropagation(),t(r.id)},style:{background:"var(--tab-button-active-bg)",border:"none",color:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",padding:"4px 8px",borderRadius:6,transition:"all 0.2s ease",userSelect:"none"},onMouseEnter:n=>n.currentTarget.style.opacity=.85,onMouseLeave:n=>n.currentTarget.style.opacity=1,title:"Add Note",type:"button",children:"+ Note"})}),y===r.id&&e.jsxs("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:[e.jsx("textarea",{rows:2,value:c,onChange:n=>u(n.target.value),placeholder:"Write a note...",style:{width:"100%",padding:8,borderRadius:12,fontSize:13,border:"1px solid var(--input-border)",resize:"none",outline:"none",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.1)",backgroundColor:"var(--input-bg)",color:"var(--text-primary)"}}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{onClick:()=>I(r.id),style:{padding:"6px 16px",background:"#28a745",color:"#fff",border:"1px solid #28a745",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:500,transition:"all 0.2s ease",userSelect:"none"},onMouseEnter:n=>{n.currentTarget.style.background="#218838",n.currentTarget.style.borderColor="#218838"},onMouseLeave:n=>{n.currentTarget.style.background="#28a745",n.currentTarget.style.borderColor="#28a745"},type:"button",children:"Save"}),e.jsx("button",{onClick:()=>{t(null),u("")},style:{padding:"6px 16px",background:"#f8f9fa",color:"#212529",border:"1px solid #ced4da",borderRadius:6,cursor:"pointer",fontSize:13,fontWeight:500,transition:"all 0.2s ease",userSelect:"none"},onMouseEnter:n=>{n.currentTarget.style.background="#e2e6ea"},onMouseLeave:n=>{n.currentTarget.style.background="#f8f9fa"},type:"button",children:"Cancel"})]})]})]},r.id)})})]})]})}function Z({client:a}){const{state:h}=U(),l=m(b=>b.common.page_route),s=m(b=>b.common.calllog),[d,v]=i.useState("recent"),f=Array.isArray(s)?s:s?[s]:[];return l==="call"?e.jsx(O,{client:a}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",fontFamily:"Segoe UI, sans-serif",height:"100%",minHeight:0,background:"var(--background)",color:"var(--text-primary)"},children:[e.jsxs("div",{style:{display:"flex",gap:0,marginBottom:"12px",borderRadius:"8px",overflow:"hidden",background:"var(--surface)",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[e.jsx("button",{onClick:()=>v("recent"),style:M(d==="recent"),children:"Recent Calls"}),e.jsx("button",{onClick:()=>v("contacts"),style:M(d==="contacts"),children:"Contact List"})]}),e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"auto"},children:[d==="recent"&&e.jsx(Y,{calls:f,client:a}),d==="contacts"&&e.jsx(_,{client:a})]})]})}const M=a=>({flex:1,padding:"12px",background:a?"var(--tab-button-active-bg)":"var(--tab-button-inactive-bg)",color:a?"#fff":"var(--tab-button-inactive-color)",fontWeight:a?600:400,fontSize:"16px",outline:"none",border:"none",borderBottom:a?"3px solid #0077ff":"3px solid transparent",cursor:"pointer",transition:"background-color 0.3s, color 0.3s, border-bottom 0.3s",borderRadius:"8px 8px 0 0",boxShadow:a?"0 2px 8px rgba(0,0,0,0.07)":"none",zIndex:a?1:0});export{Z as default};
